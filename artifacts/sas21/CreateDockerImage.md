# Create a docker image for brbo

## Install all dependencies except for `cil`

1. `winpty docker run -it  --privileged -v //c/Users/tianh:/home/tianh  debian:buster-slim`
2. `apt-get install opam libgmp-dev libmpfr-dev libntl-dev`
3. `opam init  --disable-sandboxing`
4. `opam switch create 4.06.0`
5. `opam remote add sv2  git://github.com/litho17/sv-opam.git`
6. `opam install ocamlgraph batteries.2.8.0 cil oasis ppx_deriving Z3.4.7.1 apron ounit menhir OCRS ntl`
    - This step would fail to install `ntl` and `cil`.
7. `opam install ntl`
8. `opam install cil`
9. `apt-get install scons`
10. `apt-get install curl`
11. `apt-get install libboost-all-dev`

### Install `cil`

If `opam init` was executed (instead of `opam init  --disable-sandboxing`), remove the following from `$HOME/.opam/config`:
```
wrap-build-commands:
  ["%{hooks}%/sandbox.sh" "build"] {os = "linux" | os = "macos"}
wrap-install-commands:
  ["%{hooks}%/sandbox.sh" "install"] {os = "linux" | os = "macos"}
wrap-remove-commands:
  ["%{hooks}%/sandbox.sh" "remove"] {os = "linux" | os = "macos"}
```

### References

1. https://discuss.ocaml.org/t/help-with-set-up-opam-sandboxing-fails-on-windows-wsl/3456
2. https://discuss.ocaml.org/t/install-opam-1-package-via-opam-2/2776

## Install Oracle JDK 1.8

1. Download `jdk-version-linux-x64.tar.gz`.
2. `mkdir -p /usr/lib/jvm`
3. `tar zxvf jdk-version-linux-x64.tar.gz -C /usr/lib/jvm`
4. `update-alternatives --install "/usr/bin/java" "java" "/usr/lib/jvm/jdk1.8.0_version/bin/java" 1`
5. `update-alternatives --install "/usr/bin/javac" "javac" "/usr/lib/jvm/jdk1.8.0_version/bin/javac" 1`
6. `update-alternatives --set java /usr/lib/jvm/jdk1.8.0_version/bin/java`
7. `update-alternatives --set javac /usr/lib/jvm/jdk1.8.0_version/bin/javac`


## Install scala and sbt

1. `curl -s "https://get.sdkman.io" | bash`
2. `source "$HOME/.sdkman/bin/sdkman-init.sh"`
3. `sdk version`
4. `sdk install sbt`
5. `sdk install scala 2.12.12`


## Docker

Create an instance

```
winpty docker run -it --privileged -v //c/Users/tianh:/home/tianh sas-artifact-41
```

Remove an image

```
docker image rm dc3b262b8bb3
```

Create an image

```
docker commit 5107af520423 sas-artifact-41
```

Export an image

```
docker save -o sas-artifact-41.tar sas-artifact-41
```

Import an image

```
docker load < sas-artifact-41.tar
```

See all images

```
docker images
```

See the running containers

```
docker ps
```

## Reference

1. https://sdkman.io/sdks
2. https://docs.datastax.com/en/jdk-install/doc/jdk-install/installOracleJdkDeb.html


## List of packages for successfully compiling ICRA

```
root@e0d820b29871:/# opam list
[WARNING] Running as root is not recommended
# Packages matching: installed
# Name                   # Installed # Synopsis
apron                    v0.9.13     APRON numerical abstract domain library
base-bigarray            base
base-bytes               base        Bytes library distributed with the OCaml compiler
base-threads             base
base-unix                base
batteries                2.8.0       a community-maintained standard library extension
camlidl                  1.09        Stub code generator for OCaml
cil                      20180523    A front-end for the C programming language that facilitates program analysis and transformation
conf-gmp                 3           Virtual package relying on a GMP lib system installation
conf-m4                  1           Virtual package relying on m4
conf-mpfr                2           Virtual package relying on library MPFR installation
conf-ntl                 1           Virtual package relying on a NTL system installation.
conf-perl                1           Virtual package relying on perl
conf-python-2-7          1.1         Virtual package relying on Python-2.7 installation
cppo                     1.6.7       Code preprocessor like cpp for OCaml
dune                     2.8.5       Fast, portable, and opinionated build system
menhir                   20210419    An LR(1) parser generator
menhirLib                20210419    Runtime support library for parsers generated by Menhir
menhirSdk                20210419    Compile-time library for auxiliary tools related to Menhir
mlgmpidl                 1.2.13      OCaml interface to the GMP library
ntl                      20180523    Number Theory Library
num                      1.4         The legacy Num library for arbitrary-precision integer and rational arithmetic
oasis                    0.4.11      Tooling for building OCaml libraries and applications
ocaml                    4.06.0      The OCaml compiler (virtual package)
ocaml-base-compiler      4.06.0      Official 4.06.0 release
ocaml-compiler-libs      v0.12.3     OCaml compiler libraries repackaged
ocaml-config             1           OCaml Switch Configuration
ocaml-migrate-parsetree  2.1.0       Convert OCaml parsetrees between different versions
ocaml-secondary-compiler 4.08.1-1    OCaml 4.08.1 Secondary Switch Compiler
ocamlbuild               0.14.0      OCamlbuild is a build system with builtin rules to easily build most OCaml projects.
ocamlfind                1.8.1       A library manager for OCaml
ocamlfind-secondary      1.8.1       ocamlfind support for ocaml-secondary-compiler
ocamlgraph               2.0.0       A generic graph library for OCaml
ocamlify                 0.0.1       Include files in OCaml code
ocamlmod                 0.0.9       Generate OCaml modules from source files
OCRS                     20190706    Recurrence solver based on operational calculus
ounit                    2.2.4       This is a transition package, ounit is now ounit2
ounit2                   2.2.4       OUnit testing framework
ppx_derivers             1.2.1       Shared [@@deriving] plugin registry
ppx_deriving             5.2.1       Type-driven code generation for OCaml
ppxlib                   0.22.0      Standard library for ppx rewriters
result                   1.5         Compatibility Result module
sexplib0                 v0.14.0     Library containing the definition of S-expressions and some base converters
stdlib-shims             0.3.0       Backport some of the new stdlib features to older compiler
Z3                       4.7.1       Z3 SMT solver
```